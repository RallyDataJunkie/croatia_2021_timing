---
title: "`r params$doc_title`"
subtitle: "A RallyDataJunkie Adventure"
author: "Tony Hirst"
description: "Stage results, WRC Rally Croatia, 2021"
knit: "bookdown::render_book"
site: bookdown::bookdown_site
date: "Last generated on `r format(Sys.time(), '%d %B, %Y')`"
always_allow_html: yes
new_session: no

params:
  doc_title: "Stage Results"
---

# Preface {-}

Automatically generated stage timing and results for stages on *WRC Rally Croatia, 2021*.

Based on analysis of timing and results data downloaded from the WRC website.

To discuss / critique / comment on these analyses, please use the [discussion forum](https://github.com/RallyDataJunkie/croatia_2021_timing/discussions/).

For a guide to the code used to generate the stage reports, see [*Visualising WRC Rally Results*](https://rallydatajunkie.com/visualising-wrc-rally-results).

See also [*Visualising WRC Rally Stages*](https://rallydatajunkie.com/visualising-rally-stages/).

*This report is unofficial and is not associated in any way with the Fédération Internationale de l’Automobile (FIA) or WRC Promoter GmbH.*

<!--chapter:end:index.Rmd-->


```{r setup, warning=FALSE, include=FALSE, echo=FALSE, message=FALSE, output=FALSE}
library(knitr)
library(formattable)

source('_code/wrc-api.R')
source('_code/wrc-wrangling.R')
source('_code/wrc-charts.R')
source('timing_sketches.R')
```

```{r init_vars, warning=FALSE, include=FALSE, echo=FALSE, message=FALSE, output=FALSE}
# Load in event data
s = get_active_season()
eventId = get_eventId_from_name(s, 'croatia')

itinerary = get_itinerary(eventId)
sections = get_sections(itinerary)
stages = get_stages(sections) #status and code are useful...
stages_lookup = get_stages_lookup(stages)

# For driver details
entries = get_rally_entries(eventId)
cars = get_car_data(entries)

# We can have customer entries which mess things up...
wrc = cars %>% filter(entryId<+22439)
wrc_entries = wrc$entryId
```

```{r looper, message=FALSE, echo=FALSE, error=FALSE, warning=FALSE, results='asis'}

stage_list=list("SS1")

for (stage_code in stage_list){
  src = knit_expand("test-template.Rmd")
  cat(knit_child(text=src,
                 options = list(echo=FALSE, warning=FALSE, error=FALSE),
                 quiet=TRUE))
}
```


<!--chapter:end:multi-template-test.Rmd-->

